'use strict';

var request = require('request');
var cheerio = require('cheerio');
var yargs = require('yargs');
var argv = require('yargs').argv;

var config = require('./config');
var client = require('twilio')(config.twilio.sid, config.twilio.token);

var options = {
  url: 'https://www.fandango.com/napi/theaterShowtimeGroupings/199155/2017-11-04?zip=11566&lat=40.65&long=-73.55&isdesktop=true&limit=5',
  headers: {
    'cookie': '__gads=ID=66b93ed82bf9a974:T=1477950359:S=ALNI_MZlmpJv6dA8N2gscWqQutp9Vfh-5g; __qca=P0-857791877-1477950361007; googleClickId=; __utma=3215655.2125144575.1477950359.1485576856.1485620536.23; s_fid=19D8B15DC96041DE-32214FFB0E220B1E; fd-dc=tm; s_vi=[CS]v1|2C0BDDCB8507A857-60000115E0053FC8[CE]; searchvalue=10001; dma=New York; dmazip=10001; _tq_id.TV-81362718-1.4e33=d774fe5dc7d363af.1496411708.0.1503595769..; pl_uuid=521b8410; zip=11566; searchcity=Merrick; searchstate=NY; searchlocation=lat=40.6488134&long=-73.55352340000002&name=Merrick%2C%20NY; akamai_set_zip=false; ecust=1|NCwrMddpFosWO7zzmcsHbRBvk/Y9NLFw2ZgeTowQxHtorLhN+lB3mV4bw1nlj67HuOnIfwMOcWtM7pYTTj66rB7aYe96GbUJWLKJAg8uTIhT0GB3E/ncBAlgxrOpGunGAoJH/NuDd81WPsghdLW0eUHCBOkTeLFbC4ouairb+4yvJkpCnjIk2/mEc455uc/S7g02PpLTIapQ7yFc4luFRRUiziqkkE0E5hcRSFKuR7vhRlIw; lastpaymethod=creditcard; AMCVS_8CF467C25245AE3F0A490D4C%40AdobeOrg=1; bm_monthly_unique=true; ASP.NET_SessionId=as0xcyuyxmzdwohwykurzo3y; bm_weekly_unique=true; QSI_SI_9XHiptEQ0fmrVEp_intercept=true; bandid=; RedirectLocation=https%3A//tickets.fandango.com/transaction/ticketing/express/ticketboxoffice.aspx%3Ftid%3DAAODG%26sdate%3D2017-11-04+19%3A20%26mid%3D204722%26from%3Dmov_det_showtimes%26row_count%3D0; AMCV_8CF467C25245AE3F0A490D4C%40AdobeOrg=1099438348%7CMCAID%7C2C0BDDCB8507A857-60000115E0053FC8%7CMCIDTS%7C17466%7CMCMID%7C88669655910541835763038556145490434788%7CMCAAMLH-1509635747%7C9%7CMCAAMB-1509635747%7Cr71stHQlwpUGPSNXnKDjMbocBxuhJfgGTUWOy3k5nrKEuDo%7CMCOPTOUT-1509038147s%7CNONE%7CMCSYNCSOP%7C411-17473%7CvVersion%7C2.1.0; bm_daily_unique=true; bm_sample_frequency=100; QSI_HistorySession=https%3A%2F%2Fwww.fandango.com%2F~1506842087195%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-overview~1507168488999%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times~1507168492134%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Fdate%3D2017-11-04~1507168494706%7Chttps%3A%2F%2Fwww.fandango.com%2F~1508337831287%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-overview~1508337838393%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Fdate%3D2017-11-04~1508337844915%7Chttps%3A%2F%2Fwww.fandango.com%2F~1508730773833%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-overview~1508731712643%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times~1508731718662%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Fdate%3D2017-11-04~1508731722485%7Chttps%3A%2F%2Fwww.fandango.com%2F~1508877873526%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-overview~1508877881168%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times~1508877883848%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Fdate%3D2017-11-04~1508877886091%7Chttps%3A%2F%2Fwww.fandango.com%2F~1509031251817%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor%3Aragnarok2017-199155%2Fmovie-overview~1509031279166%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times~1509031282176%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Fdate%3D2017-11-04~1509031349176%7Chttps%3A%2F%2Fwww.fandango.com%2Fthor-ragnarok-2017-199155%2Fmovie-times%3Flocation%3D11566%26date%3D11%252F4%252F2017~1509032193671; s_cc=true; _ga=GA1.2.2125144575.1477950359; _gid=GA1.2.531649795.1509030947; aam_uuid=81963765826939960742349108368991498326; WRUIDAWS=1306386968862862; __CT_Data=gpv=824&apv_124_www12=821&cpv_124_www12=249&rpv_124_www12=139&apv_227_www12=3&cpv_227_www12=3&rpv_227_www12=3; sat_ppv=31; bm_last_load_status=BLOCKING; _awl=3.42.3-56b84cba3ff86ad46cee5764c575d9fd-412d3539333332413845434333313846313438383946383241422d3131-6763652d75732d6561737431; s_pers=%20qpv_pagename%3Dpurchase%2520%257C%2520seat%2520picker%2520%257C%2520onepage%7C1497454732836%3B%20s_nr%3D1497452932842-Repeat%7C1500044932842%3B%20s_cvp%3D%255B%255B%2527EM_FAND_20170623_FAND_MRKT_NLTR_RTA_Transformers_v02%2527%252C%25271498244556819%2527%255D%255D%7C1656010956819%3B%20s_vnum%3D1511322772185%2526vn%253D4%7C1511322772185%3B%20s_invisit%3Dtrue%7C1509035004884%3B%20s_dayslastvisit%3D1509033204888%7C1603641204888%3B%20s_dayslastvisit_s%3DLess%2520than%25207%2520days%7C1509035004888%3B; s_sess=%20prevPage%3Dmovie%2520times%2520%257C%2520by%2520movie%2520%257C%2520thor%253A%2520ragnarok%2520%25282017%2529%2520%257C%2520all%2520theaters%3B; s_sq=fanprod%252Cfanwebglobal%3D%2526c.%2526a.%2526activitymap.%2526page%253Dmovie%252520times%252520%25257C%252520by%252520movie%252520%25257C%252520thor%25253A%252520ragnarok%252520%2525282017%252529%252520%25257C%252520all%252520theaters%2526link%253DSat%252520NOV%25252004%2526region%253Dscroll-date-picker__list%2526pageIDType%253D1%2526.activitymap%2526.a%2526.c%2526pid%253Dmovie%252520times%252520%25257C%252520by%252520movie%252520%25257C%252520thor%25253A%252520ragnarok%252520%2525282017%252529%252520%25257C%252520all%252520theaters%2526pidt%253D1%2526oid%253Dhttps%25253A%25252F%25252Fwww.fandango.com%25252Fthor-ragnarok-2017-199155%25252Fmovie-times%25253Flocation%25253D11566%252526date%25253D2017-11-04%2526ot%253DA; mbox=PC#1505964988023-706748.17_81#1510242806|session#1509030946784-876274#1509035066|check#true#1509033266; adops_master_kvs=; mps_uuid=8771e11e-ce73-4492-8151-52234da23813; satellite=%257B%257D; akamai_location={"zip":"10001-10014+10016-10041+10043-10045+10055+10060+10065+10069+10075+10080-10081+10087+10090+10095+10101-10126+10128-10133+10138+10150-10179+10185+10199-10200+10203+10211-10213+10242+10249+10256-10261+10265+10268-10282+10285-10286+10292","city":"NEWYORK","state":"NY","county":"NEWYORK","areacode":"212","lat":"40.7500","long":"-73.9967","countrycode":""}; screenplay_platform=desktop; akamai_generated_location={"zip":"10001-10014+10016-10041+10043-10045+10055+10060+10065+10069+10075+10080-10081+10087+10090+10095+10101-10126+10128-10133+10138+10150-10179+10185+10199-10200+10203+10211-10213+10242+10249+10256-10261+10265+10268-10282+10285-10286+10292","city":"NEWYORK","state":"NY","county":"NEWYORK","areacode":"212","lat":"40.7500","long":"-73.9967","countrycode":"US"}',
    'referer': 'https://www.fandango.com/thor-ragnarok-2017-199155/movie-times?location=11566&date=2017-11-04'
  }
};

function callback(error, response, body) {
  if (!error && response.statusCode == 200) {
    var data = JSON.parse(body);
    data.theaterShowtimes.theaters.forEach(function(theater) {
    	console.log(theater.name);
    	theater.variants.forEach(function(variant) {
    		//if (variant.formatName === "Standard") {
    			variant.amenityGroups.forEach(function(amenityGroup) {
    				console.log(amenityGroup.showtimes);
    			});
    		//}
    	});
    });
  }
}

request(options, callback);